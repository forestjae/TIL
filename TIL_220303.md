# TIL_220303

### 개요 / 키워드

## MVVM Clean Architecture

이번 프로젝트에서 MVVM 구조를 사용해보려고 설계를 하다가, 데이터의 원천을 어디에 두어야 하는지에 대한 의문점을 시작으로 Clean Architecture를 살펴보게 되었다.

해당 설계의 핵심은 특정 라이브러리나 외부환경(기기 등)에 종속되지 않는 Pure한 코드를 Domain Layer로 분리한다는 것에 있다. 

클린 아키텍쳐에 MVVM형태로 앱을 설계한다면, 내가 이해한 내용은 다음과 같다.

1. Domain Layer
    Domain Layer에는 앱 사용자의 시나리오가 UseCase라는 형태로 표현되게되며, 또 우리가 일반적으로 Model이라고 분류하는 Entity 및 비즈니스 로직들도 이곳에 포함된다. UseCase의 행위는 Model과 데이터의 원천을 변경한다.
2. Data Layer
    Data의 원천이 존재하는 장소이다. Data Repository는 특정 라이브러리(Realm, CoreData, FireStore, 서버 등)에 종속되지 않는 형태로 Data를 관리한다. UseCase는 이 Repository를 한단계 추상화 해서 '알고 있다'.
3. ViewModel
    ViewModel은 Presenter라고도 표현되는데, 특정 UI 패러다임에 종속되지 않는다. ViewModel은 View의 이벤트를 받아 처리하는데, 이때 Domain Layer에 정의된 UseCase를 사용한다. View를 표현하는데 필요한 Presentation 로직을 담당한다.
4. View
    View는 특정 UI 패러다임을 사용하여 구현되며 ViewModel을 '알고 있고', 바인딩이 되어있다. 특정 이벤트 발생 시 ViewModel에 알린다. 순수히 View를 표현하는 코드만 존재해야 한다.
   

클린아키텍쳐 + MVVM 외에도 RIBs와 Viper등 여기서 파생된 수많은 아키텍쳐들이 있었다.(한 블로그에서 클린아키텍쳐는 iOS APP에서는 과한 설계라는 의견도 볼 수 있었다.) 
내가 느끼기엔 모든 아키텍쳐들의 목적은 역할과 책임에 따른 계층 분리와 그에 따른 코드의 분리이고 궁극적으로는 확장과 변경에 용이하게 대응 할 수 있는 코드를 작성하는 것이다. 특정 아키텍쳐에 매몰되지 않고 이 아키텍쳐의 본질과 의도하는 바가 무엇인지를 파악하고 사용하는 것이 중요할 것 같다.

## Async / Await
- 비동기 작업이 포함된 작업을 수행하는 함수를 구현할 때 흔히 쓰이는 컴플리션 핸들러의 단점
  1. 중첩되어 사용된다면 콜백 지옥에 빠짐
  2. 에러 처리의 어려움. Result로 개선해도 마찬가지
  3. 조건부 실행이 어려움.

-> 위와 같은 현상을 해결하기 위해 async/await 도입.

### 예제 및 흐름
![](2022-03-04-10-44-15.png)

1. 비동기로 처리할 작업이 포함되어있는 함수(블록, 클로저)에 async 키워드를 붙여 선언한다. -> 해당 함수가 비동기로 작동한다는 것을 나타냄
2. 비동기로 처리할 메서드 앞에 await키워드를 붙여 호출한다.
3. 본 함수의 흐름이 진행되다가 await키워드를 만나게 되면 흐름이 일시 중단되며 현재 자신이 실행되는 쓰레드의 제어권을 시스템으로 넘긴다.
4. 시스템은 넘겨받은 쓰레드를 '다른작업'에 분배하며, 그동안 await키워드 뒤에 있던 비동기 작업이 진행된다(->비동기 작업을 동기시킨다).
5. await 키워드 뒤에있던 비동기 작업이 종료되면 본 함수의 나머지 코드가 실행되어야 하므로 시스템이 다시 쓰레드를 주어 나머지 부분을 실행시킨다.
    * **다만, 이 때 다시 분배된 쓰레드가 기존 쓰레드라고 보장할 수 없다.** 

간편하지만, 쓰레드의 제어권을 포기한다는 점에서 사용할 때 주의가 필요하다. 이를 보완하기 위해 Task로 선언 시 우선순위를 부여할 수도 있고, Actor라는 개념도 사용 할 수 있는것 같다. 메인쓰레드에서 실행되어야만 하는 UI작업의 경우 MainActor에서 실행되도록 명시해주는 작업이 필요할 것 같다. Actor는 나중에 더 알아보자..

## 고민한 것

---
### Feeling

### Question & Trouble

### Futher Learning

### Reference