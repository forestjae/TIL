## **TIL(Today I Learned)**

220103(ê¸ˆ)

# Fetching Website Data into Memory (ê³µì‹ë¬¸ì„œ ë²ˆì—­)

- Data taskë¥¼ ìƒì„±í•˜ê³  URL sessionì„ í†µí•´ì„œ Dataë¥¼ Memoryë¡œ ë°›ëŠ” ë°©ë²•

## Overview

- `URLSessionDataTask` í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì—¬ ì‘ë‹µ ë°ì´í„°ë¥¼ ë©”ëª¨ë¦¬ë¡œ ë°›ì„ ìˆ˜ ìˆë‹¤. ( â†”Â ë°ì´í„°ë¥¼ file systemìœ¼ë¡œ ë°›ëŠ” `URLSessionDownloadTask` ì™€ ìƒì¶©ë˜ëŠ” ê°œë…)
- Data taskëŠ” web service ë§ˆì§€ë§‰ë‹¨ì„ í˜¸ì¶œí•˜ëŠ”ë° ì´ìƒì ì¸ ë°©ë²•.
- Taskë¥¼ ë§Œë“¤ê¸° ìœ„í•´ URL session ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì‚¬ìš©í•œë‹¤. (If you want to interact with the transfer through delegate callbacks, youâ€™ll need to create a session instead of using the shared instance.)
- ë‹¨ìˆœí•œ ì‘ì—…ì„ ìœ„í•´ì„œëŠ” URLSessionì˜ `shared` ì¸ìŠ¤í„´ìŠ¤ë¥¼ í™œìš© í•  ìˆ˜ë„ ìˆë‹¤.
- ì„¸ì…˜ì„ ìƒì„±í• ë•Œ  `URLsessionConfiguration` ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ê²Œ ë˜ê³ , ì´ í´ë˜ìŠ¤ë¥¼ pass iní•˜ì—¬ `URLSessionDelegate`ë‚˜ ë”œë¦¬ê²Œì´íŠ¸ì˜ í•˜ìœ„ í”„ë¡œí† ì½œì„ implement í• ìˆ˜ ìˆë‹¤.
- ì„¸ì…˜ì€ ì—¬ëŸ¬ê°œì˜ íƒœìŠ¤í¬ë¥¼ ë§Œë“œëŠ” ë° ì¬ì‚¬ìš© ë  ìˆ˜ ìˆê¸° ë•Œë¬¸ì—, íŠ¹ì •í•œ Configurationì„ ê°ê° ì ìš©í•˜ê³  ì‹¶ë‹¤ë©´ ì„¸ì…˜ì„ ë§Œë“¤ê³  propertyë¡œ ì €ì¥í•´ ë†“ì.

<aside>
ğŸ’¡ í•„ìš”í•œ ì„¸ì…˜ë³´ë‹¤ ë” ë§ì€ ì„¸ì…˜ì„ ë§Œë“œëŠ”ë° ì£¼ì˜í•´ì•¼ í•œë‹¤. ì™œ??

</aside>

- Sessionì˜ `dataTask()` ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ taskë¥¼ ìƒì„±í•œë‹¤. ìƒì„±ëœ taskëŠ” ì¤‘ë‹¨ëœ ìƒíƒœì´ê³ , `resume()` ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ì‹œì‘í•œë‹¤.

### Receive Results with a Completion Handler

ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ”(fetch)í•˜ëŠ” ê°€ì¥ ê°„ë‹¨í•œ ë°©ë²•ì€ completion handlerë¥¼ ì‚¬ìš©í•˜ëŠ” data taskë¥¼ ë§Œë“œëŠ” ê²ƒì´ë‹¤. ì•„ë˜ì™€ ê°™ì´ taskëŠ” ì„œë²„ì˜ ì‘ë‹µ, ë°ì´í„°, ì—ëŸ¬ë¥¼ completion handler ë¸”ë¡ìœ¼ë¡œ ì „ë‹¬í•œë‹¤. 

![taskë¡œë¶€í„° ê²°ê³¼ë¥¼ ë°›ê¸° ìœ„í•´ completion handlerë¥¼ ìƒì„± / DataTaskê°€ ìˆ˜ì‹ í•œ ê²°ê³¼ë¥¼ CompletionHandlerë¡œ ì „ë‹¬](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/89396806-bfef-4ecd-91f5-4a5cf86bc6f1/ìŠ¤í¬ë¦°ìƒ·_2022-01-03_ì˜¤í›„_5.44.01.png)

taskë¡œë¶€í„° ê²°ê³¼ë¥¼ ë°›ê¸° ìœ„í•´ completion handlerë¥¼ ìƒì„± / DataTaskê°€ ìˆ˜ì‹ í•œ ê²°ê³¼ë¥¼ CompletionHandlerë¡œ ì „ë‹¬

completion handlerë¥¼ ì‚¬ìš©í•˜ëŠ” taskë¥¼ ë§Œë“¤ê¸° ìœ„í•´ `URLSession` ì˜ `dataTask(with:)` ë©”ì„œë“œë¥¼ ì‚¬ìš©í•œë‹¤. completion handlerëŠ” ì•„ë˜ì˜ 3ê°€ì§€ ìš”ì†Œë¥¼ ë‹¤ë£° í•„ìš”ê°€ ìˆë‹¤.

1. `error` íŒŒë¼ë¯¸í„°ê°€ nilì¸ì§€ë¥¼ í™•ì¸í•´ì•¼ í•œë‹¤. í™•ì¸í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´, transport errorê°€ ë°œìƒí•˜ì—¬ errorë¥¼ ë‹¤ë£¨ê³  ì¢…ë£Œëœë‹¤.
2. `response` íŒŒë¼ë¯¸í„°ë¥¼ ê²€ì‚¬í•´ì•¼ í•œë‹¤. ê²€ì‚¬ ë‚´ìš© : ì„±ê³µ status code, ê¸°ëŒ€í•œ MIME íƒ€ì…ê³¼ ì¼ì¹˜ ì—¬ë¶€.
3. `data` ì¸ìŠ¤í„´ìŠ¤ëŠ” í•„ìš”í•˜ë‹¤ë©´ ì‚¬ìš©í•˜ì.

ì•„ë˜ì˜ ë©”ì„œë“œëŠ” URL ì½˜í…ì¸ ë¥¼ fetchingí•œë‹¤. URLSessionì˜ shared ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì—¬ data taskë¥¼ ìƒì„±í•˜ëŠ” ê²ƒìœ¼ë¡œ ì‹œì‘í•œë‹¤. ì´ data taskëŠ” trailing closureì¸ completion handlerë¡œ ê²°ê³¼(data, response, error)ë¥¼ ì „ë‹¬í•œë‹¤. localê³¼ server ì—ëŸ¬ë¥¼ í™•ì¸í•œ í›„, ì´ handlerëŠ” dataë¥¼ Stringíƒ€ì…ìœ¼ë¡œ ë³€í™˜í•˜ì—¬ webView(WkWebView outlet)ë¡œ ë³´ë‚¸ë‹¤. ì´ëŸ¬í•œ í˜•íƒœë¥¼ data modelë¡œ ë³´ë‚¼ìˆ˜ë„ ìˆì„ ê²ƒì´ë‹¤.

```swift
func startLoad() {
    let url = URL(string: "https://www.example.com/")!
    // ë³„ë„ì˜ Session í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì§€ ì•Šê³  sharedë¥¼ ì‚¬ìš©í•˜ì˜€ìŒ
    let task = URLSession.shared.dataTask(with: url) { data, response, error in
				// errorê°€ nilì¸ì§€ í™•ì¸
        if let error = error {
            self.handleClientError(error)
            return
        }
				// reponseì˜ statusCodeë¥¼ í™•ì¸
        guard let httpResponse = response as? HTTPURLResponse,
            (200...299).contains(httpResponse.statusCode) else {
            self.handleServerError(response)
            return
        }
				// reponseì˜ MIME typeì„ í™•ì¸ 
        // ë¬¸ì œê°€ ì—†ë‹¤ë©´ dataë¥¼ Stringìœ¼ë¡œ í¬ë§·íŒ…í•˜ì—¬ ë·°ë¡œ ì „ë‹¬
        if let mimeType = httpResponse.mimeType, mimeType == "text/html",
            let data = data,
            let string = String(data: data, encoding: .utf8) {
						// UI ì—…ë°ì´íŠ¸ ì‘ì—…
            DispatchQueue.main.async {
                self.webView.loadHTMLString(string, baseURL: url)
            }
        }
    }
    // taskë¥¼ ì‹œì‘í•˜ëŠ” ë©”ì„œë“œ
    task.resume()
}
```

<aside>
ğŸ’¡ completion handlerëŠ” taskê°€ ìƒì„±ëœ GCD queueì™€ ë‹¤ë¥¸ queueì—ì„œ í˜¸ì¶œëœë‹¤. ê·¸ë˜ì„œ completion handlerë‚´ì—ì„œ UIë¥¼ ì—…ë°ì´íŠ¸ í•˜ëŠ” ì‘ì—…ì€ main queueì—ì„œ í•œë‹¤ê³  ëª…ì‹œ í•´ì¤˜ì•¼ í•œë‹¤.

</aside>

## Receive Transfer Details and Results with a Delegate

taskì˜ ì‘ì—…ì— completion handlerë¥¼ ì„¤ì •í•´ ì£¼ëŠ” ê²ƒë³´ë‹¤ ë” ë†’ì€ ìˆ˜ì¤€ì˜ ì ‘ê·¼ì„ ìœ„í•´ data taskë¥¼ ìƒì„±í•  ë•Œ delegateë¥¼ ì§€ì •í•  ìˆ˜ ìˆë‹¤. 

![taskë¡œë¶€í„° ê²°ê³¼ë¥¼ ë°›ëŠ” delegateì˜ êµ¬í˜„](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/c369c0bb-2dd9-4ec0-9e0c-37f59780f950/ìŠ¤í¬ë¦°ìƒ·_2022-01-03_ì˜¤í›„_6.11.25.png)

taskë¡œë¶€í„° ê²°ê³¼ë¥¼ ë°›ëŠ” delegateì˜ êµ¬í˜„

ì´ëŸ¬í•œ ë°©ì‹ì„ ì‚¬ìš©í•˜ë©´, ë°ì´í„°ì˜ ì¼ë¶€ê°€ ë„ì°©í–ˆì„ë•Œ `URLSessionDataDelegate` ì˜ ë©”ì†Œë“œ `urlSession(_:dataTask:didReceive:)` ë¡œ ì œê³µëœë‹¤.(ì „ì†¡ì´ ëë‚˜ê±°ë‚˜ ì—ëŸ¬ë°œìƒìœ¼ë¡œ ì‹¤íŒ¨í•  ë•Œê¹Œì§€) delegateëŠ” ì´ ë°–ì—ë„ ì „ì†¡ì¤‘ì— ë°œìƒí•˜ëŠ” ë‹¤ì–‘í•œ ì´ë²¤íŠ¸ë“¤ë„ ìˆ˜ì‹ í•  ìˆ˜ ìˆë‹¤.

delegateë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” sharedë¥¼ ì‚¬ìš©í•˜ê¸°ë³´ë‹¤ëŠ” URLSession ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë§Œë“¤ í•„ìš”ê°€ ìˆë‹¤. 

```swift
private lazy var session: URLSession = {
    let configuration = URLSessionConfiguration.default
    configuration.waitsForConnectivity = true
    return URLSession(configuration: configuration,
                      delegate: self, delegateQueue: nil)
}()
```

`init(configuration:delegate:delegateQueue)` ì´ë‹ˆì…œë¼ì´ì €ë¥¼ ì‚¬ìš©í•´ì„œ ì»¤ìŠ¤í„°ë§ˆì´ì§• í•œ configurationë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, configurationì˜ í”„ë¡œí¼í‹°ì¸  `waitsForConnectivitity` ë¥¼ trueë¡œ ì„¤ì •í•˜ë©´ sessionì´ í•„ìš”í•œ connectivityê°€ ì—†ì„ ë•Œ ì¦‰ì‹œ ì‹¤íŒ¨í•˜ì§€ ì•Šê³  ì ì ˆí•œ connectivityë¥¼ ê¸°ë‹¤ë¦¬ê²Œ ëœë‹¤.

ì•„ë˜ì˜ ì½”ë“œì—ì„œ `startLoad()` ë©”ì„œë“œëŠ” ìœ„ ì½”ë“œì—ì„œ ë§Œë“  sessionì„ ì‚¬ìš©í•´ data taskë¥¼ ì‹œì‘í•˜ê³ , 3ê°œì˜ delegate callbackì„ ì‚¬ìš©í•´ ìˆ˜ì‹ ëœ ë°ì´í„°ì™€ ì—ëŸ¬ë¥¼ ì²˜ë¦¬í•œë‹¤. ì–´ë–¤ ì¼ì„ í•˜ëŠ”ì§€ ìƒì„¸íˆ ì‚´í´ë³´ì.

1. urlSession(_:dataTask:didReceive:completionHandler:)
    
    `response`ê°€ ì„±ê³µ HTTP status codeì¸ì§€ í™•ì¸, MIME typeì´ text/html ì´ë‚˜ text/plainì¸ì§€ í™•ì¸í•œë‹¤. ë‘ê°œì˜ ì¡°ê±´ ì¤‘ í•˜ë‚˜ë¼ë„ í†µê³¼í•˜ì§€ ëª»í•˜ë©´, taskëŠ” ì·¨ì†Œëœë‹¤.
    
2. urlSession(_:dataTask:didReceive:)
    
    taskë¡œë¶€í„° ê°ê°ì˜ `Data` ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë°›ì•„ì„œ `receiveData` ë¼ê³  ë¶ˆë¦¬ëŠ” bufferì— ì¶”ê°€í•œë‹¤.
    
3. urlSession(_:task:didCompleteWithError:)
    
    ë¨¼ì €, Transport-level(ì „ì†¡ê³„ì¸µ) ì—ëŸ¬ê°€ ë°œìƒí–ˆëŠ”ì§€ë¥¼ ì‚´í•€ë‹¤. ì—ëŸ¬ê°€ ì—†ë‹¤ë©´, `receivedData` bufferë¥¼ ë¬¸ìì—´ë¡œ ë³€í™˜í•˜ê³  webViewì— ì „ë‹¬í•œë‹¤.
    

```swift
var receivedData: Data?

func startLoad() {
    loadButton.isEnabled = false
    let url = URL(string: "https://www.example.com/")!
    receivedData = Data() // receivedData ì´ˆê¸°í™”
    let task = session.dataTask(with: url) // task ìƒì„±
    task.resume()
}

// delegate methods

// responseë¥¼ ìˆ˜ì‹ (first receives a response)
func urlSession(_ session: URLSession, dataTask: URLSessionDataTask, didReceive response: URLResponse,
                completionHandler: @escaping (URLSession.ResponseDisposition) -> Void) {
    guard let response = response as? HTTPURLResponse,  // response nilì—¬ë¶€ ê²€ì‚¬
        (200...299).contains(response.statusCode), // ì„±ê³µ statusCodeì¸ì§€ ê²€ì‚¬
        let mimeType = response.mimeType, // ê¸°ëŒ€í•˜ëŠ” mimeTypeì¸ì§€ ê²€ì‚¬
        mimeType == "text/html" else {
        completionHandler(.cancel) // task ì·¨ì†Œ
        return
    }
    completionHandler(.allow) // task í—ˆìš©
}

// portion of dataë¥¼ ìˆ˜ì‹ (received expected data)
func urlSession(_ session: URLSession, dataTask: URLSessionDataTask, didReceive data: Data) {
    self.receivedData?.append(data) // receivedDataì— ìˆ˜ì‹ í•œ dataë¥¼ append
}

// taskê°€ transfer dataë¥¼ ì™„ë£Œí–ˆëŠ”ì§€ ì•Œë ¤ì¤€ë‹¤. (ì–´ë–¤ ì—ëŸ¬ê°€ ë°œìƒí–ˆëŠ”ì§€ë„)
func urlSession(_ session: URLSession, task: URLSessionTask, didCompleteWithError error: Error?) {
    DispatchQueue.main.async {
        self.loadButton.isEnabled = true
        if let error = error { // ì—ëŸ¬ ì²˜ë¦¬ ë¶„ê¸°
            handleClientError(error)
        } else if let receivedData = self.receivedData, 
            let string = String(data: receivedData, encoding: .utf8) {
            self.webView.loadHTMLString(string, baseURL: task.currentRequest?.url)
        }
    }
}
```

URL Session ë¬¸ì„œì˜ discussionì—ì„œ í†µì‹  ì¤‘ ë°œìƒí•˜ëŠ” ë‹¤ì–‘í•œ callbackì— ëŒ€í•´ì„œ ì„¤ëª…í•˜ê³  ìˆìœ¼ë‹ˆ ì‚´í´ë³´ì.

# URLSession

## Overview

URLSessionê³¼ ì—°ê´€ í´ë˜ìŠ¤ë“¤ì€ URLë¡œ ë‚˜íƒ€ë‚´ì–´ì§€ëŠ” endpoint(í†µì‹  ëì )ì— ë°ì´í„°ë¥¼ ì—…ë¡œë“œí•˜ê±°ë‚˜ ë‹¤ìš´ë¡œë“œí•˜ê²Œ í•´ì£¼ëŠ” APIë¥¼ ì œê³µí•œë‹¤. Appì´ ì‹¤í–‰ë˜ì§€ ì•ŠëŠ” ìƒíƒœì´ê±°ë‚˜ ì¤‘ë‹¨(suspended)ëœ ìƒíƒœì¼ ë•Œë„ ë‹¤ìš´ë¡œë“œ í•˜ëŠ”ë°ì— ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. `URLSessionDelegate` ë‚˜ `URLSessionTaskDelegate` ë¥¼ ì‚¬ìš©í•´ì„œ ì¸ì¦ì´ë‚˜ ë¦¬ë‹¤ì´ë ‰ì…˜, taskCompletionë¥¼ ì§€ì›í•  ìˆ˜ ìˆë‹¤.

<aside>
ğŸ’¡ URLSession APIëŠ” ì„œë¡œë‹¤ë¥¸ ë§ì€ í´ë˜ìŠ¤ê°€ ê½¤ ë³µì¡í•œ ë°©ì‹ìœ¼ë¡œ í˜‘ì—…í•˜ê¸° ë•Œë¬¸ì—, ê·¸ ë°©ì‹ì´ ë¬¸ì„œë§Œ ì½ì–´ì„œëŠ” ì´í•´ê°€ ë˜ì§€ ì•Šì„ ìˆ˜ë„ ìˆë‹¤. APIë¥¼ ì‚¬ìš©í•˜ê¸° ì „ì— [URL Loading System](https://developer.apple.com/documentation/foundation/url_loading_system) í† í”½ì„ ì½ì–´ë¼. Essentials, Uploading, Downloading ì„¹ì…˜

</aside>

ì•±ì€ í•˜ë‚˜ ë˜ëŠ” ê·¸ ì´ìƒì˜ URLSession ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•  ìˆ˜ ìˆê³ , ê°ê°ì˜ ì¸ìŠ¤í„´ìŠ¤ë“¤ì€ ì—°ê´€ëœ ê·¸ë£¹ì˜ dataí†µì‹ ì„ ì¡°ì •í•œë‹¤. ì˜ˆë¥¼ ë“¤ì–´, web browser ì•±ì„ ë§Œë“ ë‹¤ë©´, íƒ­ì´ë‚˜ ìœˆë„ìš° í•˜ë‚˜ ë‹¹ ì„¸ì…˜ í•˜ë‚˜ë¥¼ ë§Œë“¤ì–´ì•¼ í•  ê²ƒì´ê³  í˜¹ì€ í•˜ë‚˜ì˜ ì„¸ì…˜ì´ ìœ ì €ì™€ ìƒí˜¸ì‘ìš©í•  ë•Œ ë‹¤ë¥¸ ì„¸ì…˜ì€ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ë‹¤ìš´ë¡œë“œ ì‘ì—…ì„ í•  ìˆ˜ë„ ìˆë‹¤. ê°ê°ì˜ ì„¸ì…˜ì—ì„œëŠ” ì•±ì—ë‹¤ íŠ¹ì •í•œ URLë¡œì˜ ìš”ì²­ìœ¼ë¡œ ëŒ€í‘œë˜ëŠ” taskë“¤ì„ ì¶”ê°€í•˜ê²Œ ëœë‹¤.

## Types of URL Sessions

URL sessionë‚´ì˜ taskë“¤ì€ configuration objectë¥¼ ê³µìœ í•˜ê²Œ ëœë‹¤. í•˜ë‚˜ì˜ í˜¸ìŠ¤íŠ¸ì— ë™ì‹œì— ìµœëŒ€ ëª‡ê°œì˜ connectionë“¤ì„ ìƒì„±í• ì§€, ì…€ë£°ëŸ¬ ë„¤íŠ¸ì›Œí¬ë¥¼ ì‚¬ìš©í• ì§€, ë“±ë“±ê³¼ ê°™ì€ connection behaviorë¥¼ ì •ì˜í•œë‹¤.

URLSessionì€ ì‹±ê¸€í„´ `shared` ì„¸ì…˜ì„ ê°€ì§€ê³  ìˆë‹¤(configuration objectë¥¼ ê°–ê³ ìˆì§€ ì•Šì€). ë§Œì•½ í•œì •ì ì¸ ìš”êµ¬ì‚¬í•­ë“¤ë§Œ ìˆëŠ” ìƒí™©ì—ì„œëŠ” ìœ ìš©í•˜ê²Œ ì“°ì¼ê²ƒì´ë‹¤. ì´ì™¸ì— URLSessionì€ 3ê°œì˜ configurationì„ ê°€ì§€ê³ ìˆë‹¤. 

- Default Session: sharedì™€ ìœ ì‚¬í•˜ì§€ë§Œ, configureë¥¼ í•  ìˆ˜ ìˆë‹¤. dataë¥¼ ì ì§„ì ìœ¼ë¡œ(?) ì–»ê¸°ìœ„í•´ delegateë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. (í†µì‹  ì¤‘ê°„ì— ë°œìƒí•˜ëŠ” ì—¬ëŸ¬ ì´ë²¤íŠ¸ë“¤ì„ í•¸ë“¤ë§ í•  ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì„ dataë¥¼ ì ì§„ì ìœ¼ë¡œë¼ê³  í‘œí˜„í•œë“¯ í•˜ë‹¤.)
- Ephemeral session: sharedì™€ ìœ ì‚¬í•˜ì§€ë§Œ, cacheì™€ cookie, credential(authentication)ì„ diskì— wirteí•˜ì§€ ì•ŠëŠ”ë‹¤.
- Background sessions: ì•±ì´ ì‹¤í–‰ì¤‘ì´ì§€ ì•Šë”ë¼ë„ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì»¨í…ì¸ ë¥¼ ì—…ë¡œë“œí•˜ê³  ë‹¤ìš´ë°›ì„ ìˆ˜ ìˆê²Œ í•´ì¤€ë‹¤.

ê°ê°ì˜ configurationì˜ íƒ€ì…ì„ ë” ì•Œì•„ë³´ë ¤ë©´ Â `[URLSessionConfiguration](https://developer.apple.com/documentation/foundation/urlsessionconfiguration)`Â ë¬¸ì„œì˜ Â [Creating a Session Configuration Object](https://developer.apple.com/documentation/foundation/urlsessionconfiguration#1660412)Â  í† í”½ì„ ì‚´í´ë³´ì.

## Types of URL Session Tasks

ì„¸ì…˜ ë‚´ë¶€ì—ì„œëŠ” data Taskë“¤ì´ ìƒì„±ë˜ëŠ”ë°, ì´ Taskë“¤ì€ Dataë¥¼ ì„ íƒì ìœ¼ë¡œ ì„œë²„ì— ì—…ë¡œë“œí•˜ê±°ë‚˜ ë°›ì•„ì˜¬ ìˆ˜ ìˆë‹¤. ë°ì´í„°ë¥¼ ë°›ì•„ì˜¬ ë•ŒëŠ” ë””ìŠ¤í¬ì˜ fileë¡œ ë°›ê±°ë‚˜ ë©”ëª¨ë¦¬ì— ìˆëŠ” í•˜ë‚˜ ë˜ëŠ” ê·¸ ì´ìƒì˜ NSData objectë¡œ  ë°›ì„ ìˆ˜ ìˆë‹¤. URLSession APIëŠ” ë‹¤ìŒì˜ 4ê°€ì§€ íƒ€ì…ì˜ Taskë¥¼ ì œê³µí•œë‹¤.

- Data Tasks : NSData objectsë¥¼ ì‚¬ìš©í•´ì„œ ë°ì´í„°ë¥¼ ì£¼ê³ ë°›ëŠ”ë‹¤. ì´ íƒœìŠ¤í¬ëŠ” ì„œë²„ì— ì§§ê±°ë‚˜ ì´ë„ˆë™í‹°ë¸Œí•œ ìš”ì²­ì„ í•˜ëŠ”ë°ì— ì“°ì¸ë‹¤.
- Upload Tasks : Data Taskì™€ ìœ ì‚¬í•˜ì§€ë§Œ, dataë¥¼(ì£¼ë¡œ íŒŒì¼ì˜ í˜•íƒœë¡œ) ë³´ë‚´ê³  ì•±ì´ ì‹¤í–‰ë˜ì§€ ì•ŠëŠ” ìƒí™©ì—ì„œ ë°±ê·¸ë¼ìš´ë“œ ìƒì—ì„œ ì—…ë¡œë“œë¥¼ ì§€ì›í•œë‹¤.
- Download Tasks : Dataë¥¼ íŒŒì¼ì˜ í˜•íƒœë¡œ ë°›ì•„ì˜¤ê³  ì•±ì´ ì‹¤í–‰ì¤‘ì´ì§€ ì•ŠëŠ” ìƒíƒœì—ì„œ ë‹¤ìš´ë¡œë“œí•˜ê±°ë‚˜ ì—…ë¡œë“œí•˜ëŠ” ê²ƒì„ ì§€ì›í•œë‹¤.
- WebSocket Tasks : ì›¹ì†Œì¼“ TaskëŠ”  `RFC 6455` ì— ì •ì˜ëœ `WebSocket` í”„ë¡œí† ì½œì„ ì‚¬ìš©í•´ TCPì™€ TLSìƒì—ì„œ ë©”ì‹œì§€ë¥¼ êµí™˜í•œë‹¤.

## Using a Session Delegate

ì„¸ì…˜ì˜ Tasksë“¤ì€ ê°™ì€ delegateë¥¼ ê³µìœ í•œë‹¤. í†µì‹ ì¤‘ì— ë°œìƒí•˜ëŠ” ë‹¤ì–‘í•œ ì´ë²¤íŠ¸ì— ëŒ€í•œ ì •ë³´ë¥¼ ì•Œì•„ì°¨ë¦¬ê±°ë‚˜ ì•Œë ¤ì£¼ë„ë¡ delegateë¥¼ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤. ì•„ë˜ì˜ ì˜ˆì‹œë¥¼ ì°¸ê³ í•˜ì.

- ì¸ì¦ ì‹¤íŒ¨
- ë°ì´í„°ê°€ ì„œë²„ë¡œë¶€í„° ìˆ˜ì‹ ë¨
- ë°ì´í„°ê°€ cachingê°€ëŠ¥í•œ ìƒíƒœë¡œ ë³€í•¨

delegateê°€ í•„ìš”ì—†ë‹¤ë©´, ì„¸ì…˜ì„ ìƒì„±í•  ë•Œ delegateì— nilì„ ì„¤ì •í•˜ë©´ ëœë‹¤.

<aside>
ğŸ’¡ ì¤‘ìš”
ì„¸ì…˜ ê°ì²´ëŠ” ì•±ì´ ì¢…ë£Œë˜ê±°ë‚˜ ëª…ì‹œì ìœ¼ë¡œ ì„¸ì…˜ì„ ë¹„í™œì„±í™” ì‹œí‚¤ì§€ ì•ŠëŠ” í•œ, delegateì— ëŒ€í•´ ê°•í•œì°¸ì¡°ë¥¼ í•˜ê²Œ ëœë‹¤. â†’ ì„¸ì…˜ì„ ì¢…ë£Œí•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ ì•±ì´ ì¢…ë£Œë˜ê¸° ì „ê¹Œì§€ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ê°€ ë°œìƒí•˜ê²Œ ëœë‹¤.

</aside>

ìƒì„±ëœ ê° TaskëŠ”`URLSessionTaskDelegate` ì— ì •ì˜ëœ ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ sessionì˜ delegateë¥¼ call backí•œë‹¤.

## Asynchronicity and URL Sessions (ë¹„ë™ê¸°ì²˜ë¦¬)

ëŒ€ë¶€ë¶„ì˜ ë‹¤ë¥¸ ë„¤íŠ¸ì›Œí‚¹ APIì™€ ê°™ì´, URLSession APIëŠ” ë†’ì€ ë¹„ë™ê¸°ì„±ì„ ë„ê³ ìˆë‹¤. í˜¸ì¶œí•˜ëŠ” ë©”ì†Œë“œì— ë”°ë¼ ì•„ë˜ 3ê°€ì§€ ë°©ì‹ ì¤‘ í•˜ë‚˜ë¡œ ì•±ì— ë°ì´í„°ë¥¼ ë¦¬í„´í•˜ê²Œ ëœë‹¤.

- ìŠ¤ìœ„í”„íŠ¸ë¥¼ ì‚¬ìš©í•œë‹¤ë©´,  `async` í‚¤ì›Œë“œê°€ ì‚¬ìš©ëœ ë©”ì„œë“œë¥¼ ì‚¬ìš©í•´ ê³µí†µì˜ Taskë¥¼ ìˆ˜í–‰í•  ìˆ˜ ìˆë‹¤(to perform common tasks). ì˜ˆë¥¼ ë“¤ì–´, `data(from:delegate) ë©”ì„œë“œëŠ” `download(from:delegate:)` ë©”ì„œë“œê°€ íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œ í•˜ëŠ” ë™ì‹œì— dataë¥¼ ê°€ì ¸ì˜¨ë‹¤.
- Swiftë‚˜ Objective-Cì—ì„œëŠ” í†µì‹ ì´ ì™„ë£Œ ëœ ì´í›„ì— ì‹¤í–‰ ë  completion handler ë¸”ë¡ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
- Swiftë‚˜ Objective-Cì—ì„œëŠ” delegate ë©”ì„œë“œë¡œ í†µì‹ ì˜ ì§„í–‰ìƒíƒœì— ë”°ë¼ì„œ, ë˜ëŠ” ì™„ë£Œëœ ì§í›„ì— call backì„ ë°›ì„ ìˆ˜ ìˆë‹¤.

## Protocol Support

URLSession í´ë˜ìŠ¤ëŠ” `data`, `file`, `ftp`, `http`, `https` URL schemesë¥¼ ì§€ì›í•˜ë©´ì„œ, ì‚¬ìš©ìì˜ ì„¤ì •ì— ë”°ë¼ proxy serversì™€ SOCKS ê²Œì´íŠ¸ì›¨ì´ë¥¼ ì§€ì›í•œë‹¤. 

URLSessionì€ HTTP/1.1, HTTP/2, and HTTP/3 protocolì„ ì§€ì›í•œë‹¤. HTTP/2ì˜ ê²½ìš°ëŠ” `RFC 7540` ì—ì„œ ê¸°ìˆ í•˜ë“¯, ALPNì„ ì§€ì›í•˜ëŠ” ì„œë²„ê°€ í•„ìš”í•˜ë‹¤.

URLProtocolì˜ ìƒì†ì„ í†µí•´ ë³„ë„ì˜ ì»¤ìŠ¤í…€ ë„¤íŠ¸ì›Œí‚¹ í”„ë¡œí† ì½œê³¼ URL Schemeì„ ì§€ì›í•˜ê²Œ í•  ìˆ˜ ìˆë‹¤.

## App Transport Security (ATS)

iOS 9.0ê³¼ macOS 10.11ë²„ì „ ì´í›„ë¡œ URLSessionìœ¼ë¡œ ë§Œë“¤ì–´ì§„ ëª¨ë“  HTTP ì—°ê²°ì— ATSë¥¼ ì‚¬ìš©í•œë‹¤. ATSëŠ” HTTPSë¥¼ ì‚¬ìš©í•˜ëŠ” HTTP ì—°ê²°ì´ë‹¤. (`RFC 2818`)

ë” ë§ì€ ì •ë³´ëŠ” `[NSAppTransportSecurity](https://developer.apple.com/documentation/bundleresources/information_property_list/nsapptransportsecurity)` ë¬¸ì„œ ì°¸ê³ 

## Foundation Copying Behavior

ì„¸ì…˜ê³¼ Task ê°ì²´ëŠ” NSCopying í”„ë¡œí† ì½œì„ ì¤€ìˆ˜í•œë‹¤.

- ì•±ì´ sessionì´ë‚˜ taskë¥¼ ë³µì‚¬í•œë‹¤ë©´, ê°™ì€ ê°ì²´ë¥¼ ì–»ê²Œ ë  ê²ƒì´ë‹¤.
- configuration ê°ì²´ë¥¼ ë³µì‚¬í•œë‹¤ë©´, ë³„ë„ë¡œ ìˆ˜ì •í•  ìˆ˜ ìˆëŠ” ìƒˆë¡œìš´ Copyë¥¼ ì–»ê²Œ ë  ê²ƒì´ë‹¤.

## Thread Safety

URL Session APIëŠ” Thread Safetyí•˜ë‹¤. ì–´ë–¤ ì“°ë ˆë“œ ìœ„ì—ì„œë„ ììœ ë¡­ê²Œ ì„¸ì…˜ê³¼ íƒœìŠ¤í¬ë¥¼ ìƒì„±í•  ìˆ˜ ìˆë‹¤. ë§Œì•½ delegate ë©”ì„œë“œê°€ completion handlerë¥¼ í˜¸ì¶œí•œë‹¤ë©´, ê·¸ ì‘ì—…ì€ ìë™ìœ¼ë¡œ ì•Œë§ì€ delegate queueìœ„ì— ì˜ˆì•½ëœë‹¤.

---

### Futher Learning

- Tansport-Level (Network)

### Question & Trouble

### Reference